{% extends "layouts/base.html" %}
{% load static %}

{% block title %}All Users | Jack JJ Club{% endblock title %}

{% block content %}
<div class="content-wrapper">
  <!-- Page Header -->
  <section class="content-header">
    <div class="container-fluid">
      <div class="row mb-2 align-items-center">
        <div class="col-sm-6">
          <h1>All Users</h1>
        </div>
        <div class="col-sm-6 text-right">
          <a href="#" class="btn btn-primary">
            <i class="fas fa-user-plus"></i> Add New User
          </a>
        </div>
      </div>
    </div>
  </section>

  <!-- Main Content -->
  <section class="content">
    <div class="container-fluid">
      <div class="card card-outline card-primary">
        <div class="card-header">
          <h3 class="card-title"><i class="fas fa-users"></i> User Directory</h3>
        </div>
        <div class="card-body table-responsive p-0">
          <table class="table table-hover table-bordered table-striped text-sm">
            <thead class="thead-light">
              <tr>
                <th>#</th>
                <th>Avatar</th>
                <th>Member ID</th>
                <th>Username</th>
                <th>Email</th>
                <th>Name</th>
                <th>Phone</th>
                <th>Role</th>
                <th>Status</th>
                <th>Joined</th>
                <th class="text-center">Actions</th>
              </tr>
            </thead>
            <tbody>
              {% for user in users %}
              <tr>
                <td>{{ forloop.counter }}</td>
                <td class="text-center">
                  {% if user.avatar %}
                  <img src="{{ MEDIA_URL }}{{ user.avatar }}" class="img-circle" style="width:40px; height:40px; object-fit:cover;">
                  {% else %}
                  <img src="{% static 'dist/img/user2-160x160.jpg' %}" class="img-circle" style="width:40px; height:40px; object-fit:cover;">
                  {% endif %}
                </td>
                <td>{{ user.member_id }}</td>
                <td>{{ user.username }}</td>
                <td>{{ user.email }}</td>
                <td>{{ user.first_name }} {{ user.last_name }}</td>
                <td>{{ user.phone|default:"-" }}</td>
                <td>{{ user.role|default:"Member" }}</td>
                <td>
                  {% if user.is_active %}
                  <span class="badge badge-success">Active</span>
                  {% else %}
                  <span class="badge badge-danger">Inactive</span>
                  {% endif %}
                </td>
                <td>{{ user.date_joined|date:"M d, Y" }}</td>
                <td class="text-center">
                  {% if request.session.role == "admin" %} 
                  <a href="{% url 'user_edit' user.id %}" class="btn btn-sm btn-warning" title="Edit">
                    <i class="fas fa-edit"></i>
                  </a>
                  {% else %}
                  Edit-Ad
                  {% endif %}

                  {% if request.session.role == "super_admin" %}      

                  <form action="{% url 'delete_user' user.id %}" method="post" style="display: inline;" 
                  onsubmit="return confirm('Are you sure you want to delete this user?');">
                  {% csrf_token %}
                  <button type="submit" class="btn btn-sm btn-danger" title="Delete">
                    <i class="fas fa-trash"></i>
                  </button>
                </form>
                {% else %}
                Del-sa_Ad
                {% endif %}
              </td>
            </tr>
            {% empty %}
            <tr>
              <td colspan="11" class="text-center text-muted">No users found.</td>
            </tr>
            {% endfor %}
          </tbody>
        </table>
      </div>
    </div>
  </div>
</section>
</div>
{% endblock content %}
